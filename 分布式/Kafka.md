---
title: Kafka
tags: 消息队列
categories: 分布式
---

# 概览

数据为企业发展提供了基础。有了数据，就需要对数据进行分析，从而掌握更精准的信息。传统的面向用户的应用通常都是OLTP应用，采用的关系型数据库，不适合数据分析。因此需要对数据进行迁移，将数据从数据源头迁移到用以支持数据分析的地方。这就涉及到数据迁移的问题。而这个迁移的速度越快，对原有应用影响最小，就能够让专注于核心业务。

因此，在以数据为驱动力的企业，数据管道会成为一个关键性组件。如何移动数据变得和数据本身一样重要。

比如：当用户浏览淘宝网站上的商品时，后台会保存浏览记录，并对其进行分析处理，分析得出当前用户感兴趣的相关商品，并同步到商品推荐展示给用户。

**提取关键字：移动数据、数据管道、数据分析**



## 发布订阅消息系统是什么

在了解Kafka之前我们首先来了解下什么是发布订阅消息系统。

发布订阅消息系统就是消息生产者将消息进行分类并发布到一个统一的broker中，然后消费者订阅该消息并进行消费。这整个就是发布订阅消息系统。

**提取关键字：发布者、订阅者、broker**

```mermaid
graph TB
生产者服务器1-->发布订阅服务器
生产者服务器2-->发布订阅服务器
生产者服务器3-->发布订阅服务器
发布订阅服务器-->消费者服务器1
发布订阅服务器-->消费者服务器2
发布订阅服务器-->消费者服务器3
```





## Kafka是什么以及做到了什么

Kafka就是一款分布式消息发布订阅系统，又被称为"分布式流处理平台"。Kafka的数据是按照一定的**顺序持久化保存**的，可以按需读取。

### 消息和批次

Kafka中的最小数据单元就是**消息**。每一条消息就像是关系型数据库中的一条记录或者数据行。对kafka而言，消息并没有特殊的数据格式或者含义，任何消息都以字节数组的形式顺序存储。消息的键也是字节数组存储。当消息被存储到不同的分区的时候，会根据这个键产生一个哈希值，并取模分配存储到对应的分区。这样保证一样的key一定在同一个分区。

为了提高效率，消息会被分批次写入到kafka。一个批次就是一组消息。批次越大，消息越多，单位时间内存储的消息越多，单个消息传输的网络时长越久。批次数据会被压缩，可以提高数据的传输和存储能力，但会增加计算。



### 模式

对于kafka而言，消息是字节数组，晦涩难懂。因此根据应用程序的需求，用了一些额外的结构来定义了消息内容，让其便于理解，



### 主题和分区



### 生产者和消费者



### broker和集群



### 多集群



### Kafka的应用场景

- 日志收集
- 行为跟踪（结合Zipkin，实现链路追踪）



## 为什么使用Kafka







# 安装

 ```shell
wget http://mirror.bit.edu.cn/apache/kafka/2.2.0/kafka_2.11-2.2.0.tgz
tar -zxvf kafka_2.11-2.2.0.tgz
cd kafka_2.11-2.2.0
mkdir log
cd kafka_2.11-2.2.0/config
# 配置server.properties中的log路径和zookeeper路径
vim server.properties
cd ~/Documents/software/kafka_2.11-2.2.0
# 启动。Kafka默认占用9092端口
sh kafka-server-start.sh ../config/server.properties &
 ```



# 应用





# 原理

